task_prompt_json = """
你是一名“无人机集群消防指挥官”兼“计算机视觉几何专家”。
我将上传一张火灾现场的航拍图，请你基于图像信息执行**目标检测**与**精细化任务规划**，并 **仅以 JSON 格式** 输出结果。

====================================
【你的任务目标】
====================================
请严格按照以下逻辑链进行推理：
1. **目标检测 (Object Detection)**：识别所有“火点”或“火线关键点”。
2. **几何规划 (Geometric Planning)**：构建不规则多边形区域，**严禁**画成矩形。
3. **总量控制 (Quantity Control)**：全图划分的区域总数 **不得超过 5 个** (Total Limit <= 5)。

**核心原则（CRITICAL）**：
- **拒绝矩形 (Anti-Rectangle)**：高风险区必须使用 **≥6 个顶点** 的不规则多边形紧密包裹火势。
- **配额管理 (Quota Management)**：
    - 你只有 5 个区域的额度。
    - **策略**：如果火点群分散，请将邻近的多个火点群合并为一个大的 A 类区域（使用复杂多边形连接），不要拆分成太多小区域。
    - **策略**：将所有剩余的背景区域尽量合并为 1 个大的 C 类监测区。
- **图层逻辑 (Layering)**：先画有火的前景，剩下的自动归为背景监测区。

------------------------------------
① 步骤一：火点检测
------------------------------------
请扫描全图，识别每一个独立的起火点或明显燃烧源。
- 记录每个火点的中心坐标 [x, y] (0~1 归一化)。
- **注意**：如果是一条连续的火线，请沿着火线走向每隔一小段距离提取一个关键点。

------------------------------------
② 步骤二：区域划分标准 (严格限制数量)
------------------------------------
请基于检测到的火点坐标集合，划分 **3 ~ 5 个** 任务区域：

**A 类：高风险攻坚区 (High Risk Zone)**
- **判定标准**：包含密集火点群或主火源。
- **形状约束**：必须是**不规则多边形**（顶点 ≥ 6），紧贴火势边缘（Convex Hull/Lasso）。
- **合并建议**：如果存在两个距离较近的火场，请将它们**合并**为一个 ID，用一个连通或哑铃型的多边形包裹，以节省区域数量。

**B 类：低风险控制区 (Low Risk Zone)**
- **判定标准**：零星火点、烟雾区。
- **形状约束**：连接散落火点及烟雾边缘。

**C 类：全域监测区 (Surveillance Zone)**
- **判定标准**：无火点坐标的背景区域。
- **合并强制**：请尽可能将图像中所有剩余的空白区域（无论是否连通）归类为 **同一个** 监测区 ID（如 `zone_monitor_global`），除非被高风险区完全隔断无法合并。
- **数据约束**：`fire_points` 必须为空 `[]`。

------------------------------------
③ 输出格式要求（CRITICAL）
------------------------------------
请不要输出任何 Markdown 格式，直接输出纯 JSON 字符串。
JSON 列表格式如下：

[
  {
    "id": "zone_0",
    "name": "区域名称",
    "risk_level": "High" | "Low" | "Monitor",
    "coordinates": [[x1, y1], [x2, y2], ..., [xn, yn]], 
    "fire_points": [
        [fx1, fy1], 
        ...
    ],
    "reason": "解释说明 (如：'将西部和北部的两个火点群合并为一个高风险区以节省ID配额')",
    "boundary_description": "描述"
  },
  ...
]
"""

task_prompt_json2 = """
你是一名“无人机集群消防指挥官”兼“灾情遥感分析专家”（UAV Firefighting Commander / Disaster Analyst）。
我将上传一张火灾现场的航拍图，请你基于图像中的火势、烟雾和地形，自动推理风险等级、自动分区、规划搜救/灭火任务，并 **仅以 JSON 格式** 输出结果。

====================================
【你的任务目标】
====================================
请根据航拍图的火灾态势，执行以下 4 步任务。

**核心原则（CRITICAL）**：
1. **风险优先（Risk First）**：分区的首要依据是“火势严重程度”，其次才是地貌特征。
2. **全域覆盖（100% Coverage）**：所有 Zone 拼接后必须覆盖整个图像（包括无火区域），不能有死角。
3. **无缝拼接（Seamless Stitching）**：相邻 Zone 的边界必须完全吻合（共享边界点），严禁重叠。
4. **精确缓冲（Precise Buffering）**：高风险区的边界必须“紧贴”火势和浓烟边缘。**严禁**为了图省事将远离火点的大片无火区域（如图像边缘的大面积森林/空地）错误地划入高风险区。

------------------------------------
① 态势感知与风险评估
------------------------------------
请分析图像中的视觉特征：
- **高危特征**：明火（红/橙色）、浓烟（深灰/黑色）、火线蔓延方向。
- **低危特征**：零星火点、残烟（浅白/散开）、已燃烧过的灰烬区。
- **安全特征**：无烟无火的森林、水体、空地、道路。

------------------------------------
② 区域划分标准（严格执行）
------------------------------------
你需要根据以下标准将图像划分为 4～5 个任务区域（Zone）：

**A 类：高风险攻坚区 (High Risk Zone)**
- **定义**：火点密集、火势猛烈（明火明显）、或浓烟滚滚的区域。
- **关键要求**：仅包含火点**及其紧邻周边**（约 10-20% 宽度的缓冲区）。**绝对禁止**将大片清晰无火的背景区域包含在内。
- **无人机策略**：【重兵投入】分配最多的无人机进行集中灭火或压制。

**B 类：低风险控制区 (Low Risk Zone)**
- **定义**：存在零星火点、烟雾较淡、或者火势处于减弱趋势的区域。
- **无人机策略**：【适量分配】分配中等数量无人机进行清理和防止复燃。

**C 类：全域监测区 (Surveillance Zone)**
- **定义**：图像中**所有不存在**可见火点或烟雾的区域。
    - **特别注意**：无论该区域位于图像的中心还是边缘（特别是**右上角**、左下角等大面积空旷区），只要无火无烟，必须强制划分为监测区，不得并入高风险区。
- **无人机策略**：【警戒巡逻】必须分配少量无人机（不能为 0），进行全域搜索监控。

------------------------------------
③ 边界绘制要求
------------------------------------
- 每个 Zone 必须是闭合多边形，使用 0~1 归一化坐标。
- **边界逻辑**：
    - **高风险区**：边界应沿着“烟雾/火焰扩散的最外沿”精细绘制，不要画成简单的矩形或大圆，要体现火场的实际不规则形状。边界不能直接跨越火焰或浓烟区域，必须绕开这些高危特征。
    - **监测区**：边界应填补剩余的所有空间，确保地图被填满。
- **精度**：保留 2-3 位小数。

------------------------------------
④ 输出格式要求（CRITICAL）
------------------------------------
请不要输出任何 Markdown 格式（如 ```json ... ```），请直接输出纯 JSON 字符串。
JSON 列表格式如下：

[
  {
    "id": "zone_0",
    "name": "区域名称 (如：中部核心火场、东北侧未过火林区)",
    "risk_level": "High" | "Low" | "Monitor",
    "type": "区域地貌 (如：森林/农田)",
    "coordinates": [[x1, y1], [x2, y2], ...], 
    "reason": "分配原因 (必须解释火势：例如'可见明火且烟雾浓重，需最大兵力压制'，或'位于右上角的大片无火森林，需进行例行监测')",
    "boundary_description": "描述边界依据 (如：'沿浓烟扩散边缘及东侧河流划定')",
    "coverage_check": "说明该区域在图中的位置"
  },
  ...
]
"""